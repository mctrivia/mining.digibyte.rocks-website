(function() {function k(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}}function m(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):{next:k(b)}}var n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,q="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};
function r(b,a){if(a){var c=n;b=b.split(".");for(var e=0;e<b.length-1;e++){var g=b[e];g in c||(c[g]={});c=c[g]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&q(c,b,{configurable:!0,writable:!0,value:a})}}
r("Promise",function(b){function a(a){this.c=0;this.h=void 0;this.a=[];var d=this.f();try{a(d.resolve,d.reject)}catch(f){d.reject(f)}}function c(){this.a=null}function e(d){return d instanceof a?d:new a(function(a){a(d)})}if(b)return b;c.prototype.c=function(a){if(null==this.a){this.a=[];var d=this;this.f(function(){d.h()})}this.a.push(a)};var g=n.setTimeout;c.prototype.f=function(a){g(a,0)};c.prototype.h=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=0;b<a.length;++b){var c=
a[b];a[b]=null;try{c()}catch(p){this.g(p)}}}this.a=null};c.prototype.g=function(a){this.f(function(){throw a;})};a.prototype.f=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.u),reject:a(this.g)}};a.prototype.u=function(d){if(d===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof a)this.v(d);else{a:switch(typeof d){case "object":var b=null!=d;break a;case "function":b=!0;break a;default:b=!1}b?this.s(d):this.l(d)}};
a.prototype.s=function(a){var b=void 0;try{b=a.then}catch(f){this.g(f);return}"function"==typeof b?this.w(b,a):this.l(a)};a.prototype.g=function(a){this.m(2,a)};a.prototype.l=function(a){this.m(1,a)};a.prototype.m=function(a,b){if(0!=this.c)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.c);this.c=a;this.h=b;this.o()};a.prototype.o=function(){if(null!=this.a){for(var a=0;a<this.a.length;++a)h.c(this.a[a]);this.a=null}};var h=new c;a.prototype.v=function(a){var b=this.f();
a.i(b.resolve,b.reject)};a.prototype.w=function(a,b){var c=this.f();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};a.prototype.then=function(b,c){function d(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(G){l(G)}}:b}var e,l,g=new a(function(a,b){e=a;l=b});this.i(d(b,e),d(c,l));return g};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.i=function(a,b){function c(){switch(e.c){case 1:a(e.h);break;case 2:b(e.h);break;default:throw Error("Unexpected state: "+
e.c);}}var e=this;null==this.a?h.c(c):this.a.push(c)};a.resolve=e;a.reject=function(b){return new a(function(a,c){c(b)})};a.race=function(b){return new a(function(a,c){for(var d=m(b),f=d.next();!f.done;f=d.next())e(f.value).i(a,c)})};a.all=function(b){var c=m(b),d=c.next();return d.done?e([]):new a(function(a,b){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,e(d.value).i(f(g.length-1),b),d=c.next();while(!d.done)})};return a});var u=[],v=[],x=5,y=0,z="";
function A(){(function(b){if(v.length<x&&0<u.length){var a=u.shift(),c=function(b,c){for(var e=m(a.j),d=e.next();!d.done;d=e.next())d.value[b](c)};a.id=b;a.b=new XMLHttpRequest;a.b.open(a.type,z+a.url,!0);"POST"==a.type&&a.b.setRequestHeader("Content-Type","application/json");a.b.onload=function(){for(var e in v)v[e].id==b&&v.splice(e,1);200==a.b.status?c(0,a.b.response):c(1,"Unxpected Error");A()};a.b.onerror=function(){for(var a in v)v[a].id==b&&v.splice(a,1);return c(1,"Network Error")};a.b.onabort=
function(){for(var a in v)v[a].id==b&&v.splice(a,1);return c(1,"Canceled")};v.push(a);a.b.send("object"==typeof a.data?JSON.stringify(a.data):a.data);A()}})(++y)}function B(b,a,c,e){return new Promise(function(g,h){var d=!1;if("POST"!=c){for(var l=m(u),f=l.next();!f.done;f=l.next())if(f=f.value,f.url==b){f.j.push([g,h]);d=!0;break}if(!d)for(l=m(v),f=l.next();!f.done;f=l.next())if(f=f.value,f.url==b){f.j.push([g,h]);d=!0;break}}d||u.push({url:b,name:a||"",j:[[g,h]],type:c,data:e});A()})}
function C(b,a,c,e){return new Promise(function(g,h){B(b,a,c,e).then(function(a){var b=JSON.parse(a);null===b?(console.log("Invalid JSON",a),h("Invalid JSON")):g(b)},h)})}function D(b,a,c,e,g,h){return"string"==typeof a?b(a,c,g,h):new Promise(function(d,l){function f(){if(0==--p)return d(w)}var p=1,w=Array.isArray(a)?[]:{},t;for(t in a)p++,function(a,d){b(d,c,g,h).then(function(b){w[a]=b;(e||function(){})(b,a,d,c);f()},l)}(t,a[t]);f()})}function E(b,a,c){return D(C,b,a,c,"GET")}
function F(b,a,c,e){return D(C,b,c,e,"POST",a)}function H(b){z=b||""}
window.xmr={setMax:function(b){x=b;A()},setSuffix:H,setServer:H,getJSON:E,getJson:E,get:function(b,a,c){return D(B,b,a,c,"GET")},postJSON:F,postJson:F,post:function(b,a,c,e){return D(B,b,c,e,"POST",a)},cancel:function(b){for(var a=u.length,c=[];0<a--;)u[a].name==b&&(c.push(u[a].reject),u.splice(a,1));a=m(v);for(var e=a.next();!e.done;e=a.next())e=e.value,e.name==b&&e.b.abort();b=m(c);for(c=b.next();!c.done;c=b.next())c=c.value,c("Canceled");A()}};
})();